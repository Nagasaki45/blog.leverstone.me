<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
	<head>
		<link href="http://gmpg.org/xfn/11" rel="profile">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<!-- Metadata -->
	<meta name="description" content="Comparing python (with asyncio) and elixir (with cowboy, plug, and poolboy) for developing a web-app for wrapping a script.">
	<meta property="og:description" content="Comparing python (with asyncio) and elixir (with cowboy, plug, and poolboy) for developing a web-app for wrapping a script.">
	<meta property="og:title" content="Python vs. elixir for a web-app wrapper for a script" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://blog.tomgurion.me/web-script.html" />
		<meta property="og:image" content="https://blog.tomgurion.me/images/me.jpg" />

		<!-- Enable responsiveness on mobile devices-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

		<title>Tom Gurion | Blog</title>

		<!-- CSS -->
		<link href="//fonts.googleapis.com/" rel="dns-prefetch">
		<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet">

		<link rel="stylesheet" href="https://blog.tomgurion.me/theme/css/poole.css" />
		<link rel="stylesheet" href="https://blog.tomgurion.me/theme/css/hyde.css" />
		<link rel="stylesheet" href="https://blog.tomgurion.me/theme/css/syntax.css" />
		<link rel="stylesheet" href="https://blog.tomgurion.me/theme/css/youtube.css" />
		<link rel="stylesheet" href="https://blog.tomgurion.me/theme/css/style.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
	</head>

	<body class="theme-base-99">
<div class="sidebar">
	<div class="container sidebar-sticky">
		<div class="sidebar-about">

			<h1>
				<a href="/">
					<img class="profile-picture" src="https://blog.tomgurion.me/images/me.jpg">
					Tom Gurion
				</a>
			</h1>
			<p class="lead"></p>
			<p class="lead">A blog about a mixture of hobbies, work, and other interests </p>
			<p></p>
		</div>
		<nav class="sidebar-nav">
					<a class="sidebar-nav-item" href="https://tomgurion.me" rel="me">
						<i class="fa fa-home"></i>
					</a>
					<a class="sidebar-nav-item" href="https://github.com/Nagasaki45" rel="me">
						<i class="fa fa-github"></i>
					</a>
					<a class="sidebar-nav-item" href="https://twitter.com/nagasaki45" rel="me">
						<i class="fa fa-twitter"></i>
					</a>
					<a class="sidebar-nav-item" href="mailto:nagasaki45@gmail.com">
						<i class="fa fa-envelope"></i>
					</a>
			<a class="sidebar-nav-item" href="feeds/all.atom.xml">
				<i class="fa fa-feed"></i>
			</a>
		</nav>
	</div>
</div>		<div class="content container">
<div class="post">
	<h1 class="post-title">Python vs. elixir for a web-app wrapper for a script</h1>
	<span class="post-date">Sun 27 August 2017</span>
	<img alt="Python vs. elixir" src="/images/python_vs_elixir.png" style="width: 100%;" />
<p>I'm a facing a project with the following requirements:</p>
<ul class="simple">
<li>An existing script should be wrapped with a web server.</li>
<li>The script takes 10-30 seconds to run, so just let the user wait for it to complete.</li>
<li>Multiple users should be able to call the script concurrently.</li>
<li>Make sure to protect the server from overloading by limiting the number of concurrent active scripts.</li>
</ul>
<p>I created a repo with two projects, in python and elixir, to see how easy / hard the task will be with each technology.
You can find the repo <a class="reference external" href="https://github.com/Nagasaki45/web-script/">here</a>.
The frontend, and the demo script to run, are the same for both projects.
Getting and validating user input is not demonstrated, as it should be straightforward in both languages.
The idea was to compare the concurrency stuff.</p>
<div class="section" id="python">
<h2>Python</h2>
<p>The implementation is based on <a class="reference external" href="https://aiohttp.readthedocs.io/en/latest/index.html">aiohttp</a>, with no much extras.
There is a global counter to track the number of active scripts.
A new POST request checks the counter.
If it reaches the maximal allowed active scripts a 503 error is returned, indicating that the service is unavailable.
Otherwise, first, the counter is incremented.
Then, <tt class="docutils literal">asyncio.create_subprocess_exec</tt> is used to call the script.
Lastly, the result is returned to the user, and the counter is decremented under <tt class="docutils literal">finally</tt>.</p>
</div>
<div class="section" id="elixir">
<h2>Elixir</h2>
<p>The general idea is very similar.
The server is based on <a class="reference external" href="https://github.com/ninenines/cowboy">cowboy</a> and <a class="reference external" href="https://github.com/elixir-plug/plug">plug</a>.
Instead of a global counter I'm using <a class="reference external" href="https://github.com/devinus/poolboy">poolboy</a> to create a pool of workers for calling the script.
On each POST request, if the pool if full, the 503 error is returned.
Otherwise, the script is called and the result is returned to the user.</p>
</div>
<div class="section" id="conclusions">
<h2>Conclusions</h2>
<p>I'm a complete asyncio newbie, and wasn't sure how complex the implementetion will be.
It always feel a bit restrictive for me.
For example, without the already implemented <tt class="docutils literal">asyncio.subprocess</tt> module, following the requirements would be much more difficult.
I'm also more confident with elixir, as I use it almost exclusively for everything web-based.
With elixir you can use whatever library you want and make use of all of the concurrency feature of the language without any special adapters.
Surprisingly, the python solution ended up much simpler than I thought, and it is much shorter than the elixir solution (mainly due to the way a project is structured in elixir).
So, I ended with two easy to use options, hence the decision between them will be even harder.
Or maybe it's time to properly learn asyncio.</p>
</div>

</div>
		</div>
	</body>
</html>